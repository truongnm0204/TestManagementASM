<UserControl x:Class="TestManagementASM.Views.Teacher.TestFormView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:TestManagementASM.Views.Teacher"
             mc:Ignorable="d"
             d:DesignHeight="800"
        d:DesignWidth="1000">
    <UserControl.Resources>
        <local:EditModeToTitleConverter x:Key="EditModeToTitleConverter"/>
        <local:EditModeToButtonTextConverter x:Key="EditModeToButtonTextConverter"/>
    </UserControl.Resources>

    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="#1E88E5"
                Padding="20">
            <TextBlock Text="{Binding IsEditMode, Converter={StaticResource EditModeToTitleConverter}}"
                       FontSize="24"
                       FontWeight="Bold"
                       Foreground="White"/>
        </Border>

        <!-- Form Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto">
            <Grid Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="3*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel: Test Info -->
                <StackPanel Grid.Column="0">
                    <Border Background="White"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="ThÃ´ng tin bÃ i thi"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#1E88E5"
                                       Margin="0,0,0,15"/>

                            <!-- Test Name -->
                            <TextBlock Text="TÃªn bÃ i thi *"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,5"/>
                            <TextBox Text="{Binding TestName, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource ModernTextBox}"
                                     Height="35"
                                     Margin="0,0,0,15"/>

                            <!-- Class -->
                            <TextBlock Text="Lá»›p há»c *"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding TeacherClasses}"
                                      SelectedItem="{Binding SelectedClass}"
                                      DisplayMemberPath="ClassName"
                                      Style="{StaticResource ModernComboBox}"
                                      Height="35"
                                      Margin="0,0,0,15"/>

                            <!-- Duration -->
                            <TextBlock Text="Thá»i gian (phÃºt) *"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,5"/>
                            <TextBox Text="{Binding DurationMinutes, UpdateSourceTrigger=PropertyChanged}"
                                     Style="{StaticResource ModernTextBox}"
                                     Height="35"
                                     Margin="0,0,0,15"/>

                            <!-- Is Active -->
                            <CheckBox IsChecked="{Binding IsActive}"
                                      Content="KÃ­ch hoáº¡t bÃ i thi"
                                      FontWeight="SemiBold"
                                      Margin="0,0,0,15"/>

                            <!-- Available From -->
                            <TextBlock Text="CÃ³ hiá»‡u lá»±c tá»«"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,5"/>
                            <DatePicker SelectedDate="{Binding AvailableFrom}"
                                        Height="35"
                                        Margin="0,0,0,15"/>

                            <!-- Available To -->
                            <TextBlock Text="CÃ³ hiá»‡u lá»±c Ä‘áº¿n"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,5"/>
                            <DatePicker SelectedDate="{Binding AvailableTo}"
                                        Height="35"
                                        Margin="0,0,0,15"/>

                            <!-- Summary -->
                            <Border Background="#E3F2FD"
                                    BorderBrush="#1E88E5"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10"
                                    Margin="0,10,0,0">
                                <StackPanel>
                                    <TextBlock FontWeight="Bold"
                                               Foreground="#1565C0"
                                               Margin="0,0,0,5">
                                        <Run Text="Tá»•ng sá»‘ cÃ¢u há»i: "/>
                                        <Run Text="{Binding SelectedQuestions.Count, Mode=OneWay}"/>
                                    </TextBlock>
                                    <TextBlock FontWeight="Bold"
                                               Foreground="#1565C0">
                                        <Run Text="Tá»•ng Ä‘iá»ƒm: "/>
                                        <Run Text="{Binding TotalPoints, Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Right Panel: Question Selection -->
                <StackPanel Grid.Column="2">
                    <!-- Available Questions -->
                    <Border Background="White"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="NgÃ¢n hÃ ng cÃ¢u há»i"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#1E88E5"
                                       Margin="0,0,0,15"/>

                            <!-- Subject Filter -->
                            <TextBlock Text="Chá»n mÃ´n há»c"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,5"/>
                            <ComboBox ItemsSource="{Binding Subjects}"
                                      SelectedItem="{Binding SelectedSubject}"
                                      DisplayMemberPath="SubjectName"
                                      Style="{StaticResource ModernComboBox}"
                                      Height="35"
                                      Margin="0,0,0,15"/>

                            <!-- Available Questions List -->
                            <ScrollViewer MaxHeight="300"
                                          VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding AvailableQuestions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F5F5F5"
                                                    BorderBrush="#E0E0E0"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="10"
                                                    Margin="0,0,0,10">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="{Binding QuestionText}"
                                                                   FontWeight="SemiBold"
                                                                   TextWrapping="Wrap"
                                                                   Margin="0,0,0,5"/>
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding QuestionType}"
                                                                       FontSize="11"
                                                                       Foreground="#666"
                                                                       Margin="0,0,10,0"/>
                                                            <TextBlock FontSize="11"
                                                                       Foreground="#666">
                                                                <Run Text="Äá»™ khÃ³: "/>
                                                                <Run Text="{Binding DifficultyLevel}"/>
                                                            </TextBlock>
                                                        </StackPanel>
                                                    </StackPanel>

                                                    <Button Grid.Column="1"
                                                            Command="{Binding DataContext.AddQuestionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource PrimaryButton}"
                                                            Padding="10,5">
                                                        <TextBlock Text="âž•"/>
                                                    </Button>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <!-- Loading Indicator -->
                            <TextBlock Text="Äang táº£i cÃ¢u há»i..."
                                       FontStyle="Italic"
                                       Foreground="#666"
                                       HorizontalAlignment="Center"
                                       Margin="0,20,0,0"
                                       Visibility="{Binding IsLoadingQuestions, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        </StackPanel>
                    </Border>

                    <!-- Selected Questions -->
                    <Border Background="White"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1"
                            CornerRadius="8"
                            Padding="20">
                        <StackPanel>
                            <TextBlock Text="CÃ¢u há»i Ä‘Ã£ chá»n"
                                       FontSize="18"
                                       FontWeight="Bold"
                                       Foreground="#1E88E5"
                                       Margin="0,0,0,15"/>

                            <ScrollViewer MaxHeight="400"
                                          VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding SelectedQuestions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#E3F2FD"
                                                    BorderBrush="#1E88E5"
                                                    BorderThickness="1"
                                                    CornerRadius="4"
                                                    Padding="10"
                                                    Margin="0,0,0,10">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <Grid Grid.Row="0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock Text="{Binding QuestionText}"
                                                                       FontWeight="SemiBold"
                                                                       TextWrapping="Wrap"
                                                                       Margin="0,0,0,5"/>
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{Binding QuestionType}"
                                                                           FontSize="11"
                                                                           Foreground="#1565C0"
                                                                           Margin="0,0,10,0"/>
                                                                <TextBlock FontSize="11"
                                                                           Foreground="#1565C0">
                                                                    <Run Text="Äá»™ khÃ³: "/>
                                                                    <Run Text="{Binding DifficultyLevel}"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                        </StackPanel>

                                                        <Button Grid.Column="1"
                                                                Command="{Binding DataContext.RemoveQuestionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                CommandParameter="{Binding}"
                                                                Style="{StaticResource DangerButton}"
                                                                Padding="8,5">
                                                            <TextBlock Text="ðŸ—‘"/>
                                                        </Button>
                                                    </Grid>

                                                    <!-- Points -->
                                                    <StackPanel Grid.Row="1"
                                                                Orientation="Horizontal"
                                                                Margin="0,10,0,0">
                                                        <TextBlock Text="Äiá»ƒm: "
                                                                   FontWeight="SemiBold"
                                                                   VerticalAlignment="Center"
                                                                   Margin="0,0,10,0"/>
                                                        <TextBox Text="{Binding Points, UpdateSourceTrigger=PropertyChanged}"
                                                                 Width="60"
                                                                 Height="30"
                                                                 Style="{StaticResource ModernTextBox}"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <!-- Empty State -->
                            <TextBlock Text="ChÆ°a cÃ³ cÃ¢u há»i nÃ o Ä‘Æ°á»£c chá»n"
                                       FontStyle="Italic"
                                       Foreground="#999"
                                       HorizontalAlignment="Center"
                                       Margin="0,20,0,0"
                                       Visibility="{Binding SelectedQuestions.Count, Converter={StaticResource ZeroToVisibilityConverter}}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- Action Buttons -->
        <Border Grid.Row="2"
                Background="#F5F5F5"
                BorderBrush="#E0E0E0"
                BorderThickness="0,1,0,0"
                Padding="20">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right">
                <Button Command="{Binding CancelCommand}"
                        Style="{StaticResource SecondaryButton}"
                        Padding="20,10"
                        Margin="0,0,10,0">
                    <TextBlock Text="Há»§y"
                            FontSize="14"/>
                </Button>
                <Button Command="{Binding SaveTestCommand}"
                        Style="{StaticResource SuccessButton}"
                        Padding="20,10"
                        IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBooleanConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ’¾"
                                FontSize="14"
                                Margin="0,0,5,0"/>
                        <TextBlock Text="{Binding IsEditMode, Converter={StaticResource EditModeToButtonTextConverter}}"
                                FontSize="14"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <!-- Loading Overlay -->
        <Border Grid.Row="0"
                Grid.RowSpan="3"
                Background="#80000000"
                Visibility="{Binding IsSaving, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <TextBlock Text="Äang lÆ°u..."
                           FontSize="16"
                           Foreground="White"
                           FontWeight="Bold"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

