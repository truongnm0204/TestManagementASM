<UserControl x:Class="TestManagementASM.Views.Student.TestDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600"
             d:DesignWidth="900">
    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
                Background="#1976D2"
                Padding="20">
            <StackPanel Orientation="Horizontal">
                <Button Command="{Binding BackCommand}"
                        Width="35"
                        Height="35"
                        Background="#1565C0"
                        BorderThickness="0"
                        Cursor="Hand"
                        Margin="0,0,15,0">
                    <TextBlock Text="â†"
                               FontSize="20"
                               Foreground="White"
                               FontWeight="Bold"/>
                </Button>
                <TextBlock Text="CHI TIáº¾T BÃ€I THI"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="White"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- Content -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="30">
                <!-- Test Information Card -->
                <Border Background="White"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1"
                        CornerRadius="5"
                        Padding="25"
                        Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="{Binding CurrentTest.TestName}"
                                   FontSize="24"
                                   FontWeight="Bold"
                                   Foreground="#1976D2"
                                   Margin="0,0,0,20"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Left Column -->
                            <TextBlock Grid.Row="0"
                                       Grid.Column="0"
                                       Text="ðŸ“š MÃ´n há»c:"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"/>
                            <TextBlock Grid.Row="0"
                                       Grid.Column="1"
                                       Text="{Binding CurrentTest.Class.Subject.SubjectName}"
                                       Margin="0,0,0,10"/>

                            <TextBlock Grid.Row="1"
                                       Grid.Column="0"
                                       Text="ðŸ« Lá»›p:"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"/>
                            <TextBlock Grid.Row="1"
                                       Grid.Column="1"
                                       Text="{Binding CurrentTest.Class.ClassName}"
                                       Margin="0,0,0,10"/>

                            <TextBlock Grid.Row="2"
                                       Grid.Column="0"
                                       Text="â±ï¸ Thá»i gian:"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"/>
                            <TextBlock Grid.Row="2"
                                       Grid.Column="1"
                                       Margin="0,0,0,10">
                                <Run Text="{Binding CurrentTest.DurationMinutes, Mode=OneWay}"/>
                                <Run Text=" phÃºt"/>
                            </TextBlock>

                            <TextBlock Grid.Row="3"
                                       Grid.Column="0"
                                       Text="â“ Sá»‘ cÃ¢u há»i:"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"/>
                            <TextBlock Grid.Row="3"
                                       Grid.Column="1"
                                       Text="{Binding QuestionCount}"
                                       Margin="0,0,0,10"/>

                            <TextBlock Grid.Row="4"
                                       Grid.Column="0"
                                       Text="ðŸ“… Thá»i gian má»Ÿ:"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"/>
                            <TextBlock Grid.Row="4"
                                       Grid.Column="1"
                                       Margin="0,0,0,10">
                                <Run Text="{Binding CurrentTest.AvailableFrom, StringFormat='dd/MM/yyyy HH:mm'}"/>
                                <Run Text=" - "/>
                                <Run Text="{Binding CurrentTest.AvailableTo, StringFormat='dd/MM/yyyy HH:mm'}"/>
                            </TextBlock>
                        </Grid>

                        <!-- Start Test Button -->
                        <Button Command="{Binding StartTestCommand}"
                                Content="Báº®T Äáº¦U LÃ€M BÃ€I"
                                Width="200"
                                Height="45"
                                Margin="0,20,0,0"
                                Background="#4CAF50"
                                Foreground="White"
                                FontSize="16"
                                FontWeight="Bold"
                                BorderThickness="0"
                                Cursor="Hand"
                                HorizontalAlignment="Center">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="5"
                                                        Padding="20,10">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                      VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="IsEnabled"
                                            Value="{Binding CanStartTest}"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver"
                                                 Value="True">
                                            <Setter Property="Background"
                                                    Value="#45A049"/>
                                        </Trigger>
                                        <Trigger Property="IsEnabled"
                                                 Value="False">
                                            <Setter Property="Background"
                                                    Value="#CCCCCC"/>
                                            <Setter Property="Cursor"
                                                    Value="No"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <TextBlock Text="BÃ i thi hiá»‡n khÃ´ng kháº£ dá»¥ng"
                                   Foreground="#F44336"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   Margin="0,10,0,0"
                                   Visibility="{Binding CanStartTest, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>

                <!-- Previous Attempts -->
                <Border Background="White"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1"
                        CornerRadius="5"
                        Padding="25">
                    <StackPanel>
                        <TextBlock Text="Lá»‹ch sá»­ lÃ m bÃ i"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="#333333"
                                   Margin="0,0,0,15"/>

                        <DataGrid ItemsSource="{Binding PreviousAttempts}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column"
                                  RowHeight="40"
                                  FontSize="13"
                                  Background="White"
                                  BorderThickness="0">

                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background"
                                            Value="#F5F5F5"/>
                                    <Setter Property="Foreground"
                                            Value="#333333"/>
                                    <Setter Property="FontWeight"
                                            Value="SemiBold"/>
                                    <Setter Property="Padding"
                                            Value="10"/>
                                    <Setter Property="Height"
                                            Value="35"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>

                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Láº§n thá»­"
                                                    Binding="{Binding AttemptId}"
                                                    Width="Auto"/>
                                <DataGridTextColumn Header="Thá»i gian báº¯t Ä‘áº§u"
                                                    Binding="{Binding StartTime, StringFormat='dd/MM/yyyy HH:mm'}"
                                                    Width="*"/>
                                <DataGridTextColumn Header="Thá»i gian káº¿t thÃºc"
                                                    Binding="{Binding EndTime, StringFormat='dd/MM/yyyy HH:mm'}"
                                                    Width="*"/>
                                <DataGridTextColumn Header="Äiá»ƒm"
                                                    Binding="{Binding Score}"
                                                    Width="Auto"/>
                                <DataGridTextColumn Header="Tráº¡ng thÃ¡i"
                                                    Binding="{Binding AttemptStatus}"
                                                    Width="Auto"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <TextBlock Text="ChÆ°a cÃ³ láº§n lÃ m bÃ i nÃ o"
                                   Foreground="#999999"
                                   FontStyle="Italic"
                                   HorizontalAlignment="Center"
                                   Margin="0,20,0,0"
                                   Visibility="{Binding PreviousAttempts.Count, Converter={StaticResource ZeroToVisibilityConverter}}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Loading Overlay -->
        <Border Grid.Row="0"
                Grid.RowSpan="2"
                Background="#80000000"
                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                <TextBlock Text="Äang táº£i..."
                           FontSize="16"
                           Foreground="White"
                           FontWeight="Bold"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>

